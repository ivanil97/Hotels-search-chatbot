# Hotels chatbot

Данный проект представляет собой чат-бот, занимающийся поиском отелей на основании запроса к API "
Hotels" (https://rapidapi.com/apidojo/api/hotels4/details)

Данный проект реализован с помощью pyTelegramBotAPI.

## Установка

1. Получите персональный ключ API, выбрав подходящий прайсинг (https://rapidapi.com/apidojo/api/hotels4/pricing)
2. Создайте бота и получите его уникальный токен с помощью бота @BotFather в Telegram
3. Клонируйте репозиторий с помощью одной из команд:

```
git clone git@gitlab.skillbox.ru:ivan_ilin/python_basic_diploma.git
```

```
git clone https://gitlab.skillbox.ru/ivan_ilin/python_basic_diploma.git
```

4. Создайте файл `.env` по аналогии с файлом `.env.template` и внесите туда ключ API и токен вашего бота:

```
BOT_TOKEN = "Ваш токен для бота, полученный от @BotFather"
RAPID_API_KEY = "Ваш ключ полученный от API по адресу rapidapi.com/apidojo/api/hotels4/"
```

5. Подключите необходимые модули (см. файл requirments.txt)
6. Запустите чат-бот с помощью следующей команды:

```
main.py
```

## Команды

1. /start - Данная команда приветствует пользователя и кратко описывает возможности чат-бота
2. /help - Данная команда выводит справку по всем командам чат-бота
3. /low - С помощью данной команды можно подобрать варианты отелей по самой низкой цене в интересующей локации
4. /high - С помощью данной команды можно подобрать варианты отелей по самой высокой цене в интересующей локации
5. /custom - С помощью данной команды можно подобрать варианты отелей в заданном ценовом диапазоне в интересующей
   локации
6. /history - С помощью данной команды можно получить информацию по последним 10 запросам пользователя

## API's endpoints

Для обращения к API используется 3 эндпоинта:

1. locations/v3/search - предоставляет ответ по выбранной локации
2. properties/v2/list - предоставляет ответ с информацией по отелям: id отеля, название, цена и пр.
3. properties/v2/detail - предоставляет ответ с подробной информацией об отеле: точный адрес, фотографии и пр.

При возникновении ошибки во время запроса ошибки логируются в файле `logging.log` с помощью модуля `loguru` и
пользователь получает информацию об ошибке
Также в файле `logging.log` логируются все ответы сервера, код состояния которых не равен 200

## История запросов

Для хранения истории запросов используется ORM `peewee`. Для работы с базой данных реализовано 3 функции:
1. `create_data()` - функция для создания записи в БД
2. `retrieve_data()` - функция для получения последних 10 запросов пользователя
3. `retrieve_hotels()` - функция для получения детальной информации по выбранному пользователем запросу. При вызове пользователь возвращается к списку отелей, сформированному при создании данного запроса  